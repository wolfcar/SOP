# 预发布灰度发布

从1.14.0开始支持预发布、灰度发布，可登陆`SOP-Admin`，然后选择`服务列表`进行操作。

## 使用预发布

假设网关工程在阿里云负载均衡有两台服务器，域名分别为：

|域名|说明|
|:---- |:----  |
|open1.domain.com  |网关服务器1  |
|openpre.domain.com | 网关服务器2，作为预发布请求入口|

线上域名为`open.domain.com`，请求网关`http://open.domain.com/api`会负载均衡到这两台服务器

在网关工程打开`com.gitee.sop.gateway.loadbalancer.EnvironmentServerChooser`类，修改`PRE_DOMAIN`变量

```java
/**
 * 预发布机器域名
 */
private static final String PRE_DOMAIN = "openpre.domain.com";
```

网关工程打包发布到阿里云

登录SOP-Admin，在服务列表中点击预发布，然后接口的请求地址变成：`http://openpre.domain.com/api`

## 使用灰度发布

灰度发布可允许指定的用户进行访问，其它用户则走正常流程。
